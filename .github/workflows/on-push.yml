on:
  push:
    branches:    
      - master
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - uses: actions/setup-node@v2
        with:
          node-version: 16
      - name: Preinstall
        run: |
          npm install pnpm -g
          pnpm i
      - name: GitConfig
        run: |
          git config --global user.email "920733056@qq.com"
          git config --global user.name "Awen-hub"
      - name: UpdateLog
        run: |
          node changelog.mjs
      - name: Repush
        run: |
          git add .
          git commit -m "misc(log): 更新日志" -n
          git push --set-upstream origin master --no-verify --tags -f
        env:
          GITHUB_TOKEN: ${{ secrets.PUSH_TOKEN }}